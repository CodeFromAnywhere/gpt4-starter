"use strict";var __awaiter=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))((function(n,s){function o(e){try{a(i.next(e))}catch(e){s(e)}}function u(e){try{a(i.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,u)}a((i=i.apply(e,t||[])).next())}))},__generator=this&&this.__generator||function(e,t){var r,i,n,s,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(u){return function(a){return function(u){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,u[0]&&(o=0)),o;)try{if(r=1,i&&(n=2&u[0]?i.return:u[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,u[1])).done)return n;switch(i=0,n&&(u=[2&u[0],n.value]),u[0]){case 0:case 1:n=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,i=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(n=o.trys,(n=n.length>0&&n[n.length-1])||6!==u[0]&&2!==u[0])){o=0;continue}if(3===u[0]&&(!n||u[1]>n[0]&&u[1]<n[3])){o.label=u[1];break}if(6===u[0]&&o.label<n[1]){o.label=n[1],n=u;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(u);break}n[2]&&o.ops.pop(),o.trys.pop();continue}u=t.call(e,o)}catch(e){u=[6,e],i=0}finally{r=n=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,a])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.zipFiles=void 0;var fs_util_1=require("fs-util"),fs_util_js_1=require("fs-util-js"),get_path_1=require("get-path"),js_util_1=require("js-util"),model_types_1=require("model-types"),zipFolder_1=require("./zipFolder"),zipFiles=function(e){return __awaiter(void 0,void 0,void 0,(function(){var t,r,i,n,s,o;return __generator(this,(function(u){switch(u.label){case 0:return(t=(0,get_path_1.getProjectRoot)())?(r=e.map((function(e){return fs_util_1.path.join(t,e)})),(0,js_util_1.isAllTrue)(r.map((function(e){return fs_util_1.fs.existsSync(e)})))?[4/*yield*/,(0,get_path_1.getCommonAncestorMultiple)(r)]:[2/*return*/,{isSuccessful:!1,message:"Not all files exist"}]):[2/*return*/,{isSuccessful:!1,message:"No projectroot"}];case 1:return(i=u.sent())?(n=(0,model_types_1.generateId)(),s=fs_util_1.path.join(i,n),[4/*yield*/,fs_util_1.fs.mkdir(s,{recursive:!0})]):[2/*return*/,{isSuccessful:!1,message:"Couldn't find common ancestor"}];case 2:
// copy all files/folders into a temp folder
// console.log({ commonAncestor, zipName, absoluteNewFolderPath });
return u.sent(),[4/*yield*/,Promise.all(r.map((function(e){return __awaiter(void 0,void 0,void 0,(function(){var t;return __generator(this,(function(r){switch(r.label){case 0:return t=fs_util_1.path.parse(e).base,[4/*yield*/,fs_util_1.fs.cp(e,fs_util_1.path.join(s,t))];case 1:return r.sent(),[2/*return*/]}}))}))})))];case 3:
// copy all files/folders into a temp folder
return u.sent(),[4/*yield*/,(0,zipFolder_1.zipFolder)(s)];case 4:return(o=u.sent())?[4/*yield*/,fs_util_1.fs.rm(s,{recursive:!0,force:!0})]:[2/*return*/,{isSuccessful:!1,message:"Couldn't zip folder"}];
// remove the temp folder
case 5:
// remove the temp folder
return u.sent(),[2/*return*/,{isSuccessful:!0,message:"You got it",projectRelativeZipPath:(0,fs_util_js_1.makeRelative)(o,t)}]}}))}))};exports.zipFiles=zipFiles;
//# sourceMappingURL=zipFiles.js.map