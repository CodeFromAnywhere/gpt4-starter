"use strict";var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},__assign.apply(this,arguments)},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SettingsPage=exports.QueueStatusComponent=void 0;var jsx_runtime_1=require("react/jsx-runtime"),server_api_url_1=require("server-api-url"),store_1=require("./store"),setConfig_1=require("./setConfig"),react_with_native_1=require("react-with-native"),function_form_1=require("function-form"),fancy_loader_1=require("fancy-loader"),set_config_json_1=__importDefault(require("explorer-ui/db/ts-functions/set-config.json")),cool_toast_1=require("cool-toast"),next_a_link_1=require("next-a-link"),layout_1=require("layout"),react_with_native_ui_1=require("react-with-native-ui"),api_1=require("api"),react_1=require("react"),QueueStatusComponent=function(){var e,t=api_1.queries.useGetQueueStatus(),r=null===(e=null==t?void 0:t.data)||void 0===e?void 0:e.result,i=(0,react_1.useState)(Date.now()),n=i[0],s=i[1],a=r?Math.round((n-r.updatedAt)/1e3):0,_=a>=60;
// NB: refetch every minute
return(0,react_1.useEffect)((function(){_&&t.refetch()}),[_]),(0,react_1.useEffect)((function(){var e=setInterval((function(){s(Date.now())}),1e3);return function(){return clearInterval(e)}}),[]),r?(0,jsx_runtime_1.jsxs)(react_with_native_1.Div,{children:[(0,jsx_runtime_1.jsxs)(react_with_native_1.P,__assign({className:"font-bold"},{children:["Queue (last checked: ",a," seconds ago)"]})),(0,jsx_runtime_1.jsx)("pre",{children:JSON.stringify(r,void 0,2)})]}):null};exports.QueueStatusComponent=QueueStatusComponent;var SettingsPage=function(){var e=(0,layout_1.usePing)().isOffline,t=(0,store_1.useStore)("api.authToken")[0],r=(0,store_1.useStore)("api.customUrl"),i=r[0],n=(r[1],r[2].hydrated),s=(0,store_1.useStore)("explorer.config"),a=s[0],_=(s[1],s[2].hydrated);return(0,jsx_runtime_1.jsx)(react_with_native_1.Div,__assign({className:"max-lg:mx-4 lg:mx-20"},{children:_&&n?(0,jsx_runtime_1.jsxs)(react_with_native_1.Div,{children:[e?(0,jsx_runtime_1.jsx)(react_with_native_1.P,__assign({className:"text-red-500"},{children:"The API cannot be found, please set the API to your homeserver if you have it"})):null,(0,jsx_runtime_1.jsx)(function_form_1.FunctionForm,{tsFunction:set_config_json_1.default,initialValues:[i,a.disableAdmin,a.customProjectRelativeBasePaths],submitFunction:setConfig_1.setConfig,withResult:function(){(0,cool_toast_1.showStandardResponse)({isSuccessful:!0,message:"Updated"})}}),(0,jsx_runtime_1.jsx)(react_with_native_1.P,{children:(0,jsx_runtime_1.jsx)(next_a_link_1.ALink,__assign({href:"/database/Persona"},{children:"Setup your API Keys and other custom settings"}))}),(0,jsx_runtime_1.jsxs)(react_with_native_1.P,{children:["Your API key (be careful):",(0,jsx_runtime_1.jsx)(react_with_native_1.Input,{className:react_with_native_ui_1.inputClass,value:"".concat(t)})]}),(0,jsx_runtime_1.jsxs)(react_with_native_1.P,{children:["Current API address (edit above):",(0,jsx_runtime_1.jsx)(react_with_native_1.Input,{className:react_with_native_ui_1.inputClass,value:"".concat(server_api_url_1.apiUrl)})]}),(0,jsx_runtime_1.jsx)(exports.QueueStatusComponent,{})]}):(0,jsx_runtime_1.jsx)(fancy_loader_1.FancyLoader,{})}))};exports.SettingsPage=SettingsPage;
//# sourceMappingURL=SettingsPage.js.map