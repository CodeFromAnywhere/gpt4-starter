"use strict";var __rest=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]])}return r};Object.defineProperty(exports,"__esModule",{value:!0}),exports.truncateMessages=void 0;var js_util_1=require("js-util"),openai_wrapper_1=require("openai-wrapper"),truncateMessages=function(e){var t=(0,openai_wrapper_1.calculateMessagesTokenCount)(e).reverse().filter((function(e,t){return t<=9||!!(Date.now()-e.createdAt<864e5)})),r=t.findIndex((function(e,t,r){if((0,js_util_1.sum)(r.slice(0,t).map((function(e){return e.tokenCount})))>3e3)return!0})),n=-1===r?t:t.slice(0,r);
// newest first
return{truncatedMessageHistory:n.reverse().map((function(e){e.tokenCount;return __rest(e,["tokenCount"])})),inputTokensCalculated:(0,js_util_1.sum)(n.map((function(e){return e.tokenCount})))}};exports.truncateMessages=truncateMessages;
//# sourceMappingURL=truncateMessages.js.map